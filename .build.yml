# SPDX-License-Identifier: Unlicense
# SPDX-FileCopyrightText: Tristan Partin <tristan@partin.io>

image: alpine/edge
oauth: pages.sr.ht/PAGES:RW
packages:
  - go
  - hugo
  - hut
  - reuse
  - shellcheck
environment:
  site: tristan957.srht.site
sources:
  - https://git.sr.ht/~tristan957/tristan.partin.io
tasks:
  - reuse: |
      cd tristan.partin.io
      reuse lint
  - shellcheck: |
      cd tristan.partin.io
      shellcheck $(find scripts/ -type f)
  - openring: |
      cd tristan.partin.io
      ./scripts/openring/build.sh
  - build: |
      cd tristan.partin.io
      ./scripts/openring/generate.sh
      hugo --baseURL="https://$site"
  - package: |
      cd tristan.partin.io
      tar -C public -cvz . > site.tar.gz
  - upload: |
      cd tristan.partin.io
      hut pages publish -d "$site" site.tar.gz
